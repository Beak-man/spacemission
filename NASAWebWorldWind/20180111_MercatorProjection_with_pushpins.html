<!DOCTYPE html>
<!-- This is a very simple example of using Web WorldWind. -->
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Mercator Map with Push Pins</title>
    <!-- Include the Web WorldWind library. -->
	<!-- <script src="http://worldwindserver.net/webworldwind/worldwindlib.js" type="text/javascript"></script> -->
    <script src="./scripts/worldwind.min.js" type="text/javascript"></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://d3js.org/d3-collection.v1.min.js"></script>
    <script src="https://d3js.org/d3-dispatch.v1.min.js"></script>
    <script src="https://d3js.org/d3-dsv.v1.min.js"></script>
    <script src="https://d3js.org/d3-request.v1.min.js"></script>
	
</head>
<body>
<h3>2017 International Space Apps 1D,2D,3D Go! Teams</h3>
<div style="position: absolute; top: 50px; left: 50px;">
   <canvas id="canvasOne" width="1024" height="768">  
   <canvas id="canvasOne" width="1024" height="768">
        Your browser does not support HTML5 Canvas.
    </canvas>
</div>
<script>
 // Define the images we'll use for the placemarks.
        var images = [
            "Pushpin-Transparent-Background.png"    // ,
        ];
		var lats = [] ;
		var lons = [] ;
		var teamNames = [] ;
		
 function read_CSV_file() {
	 d3.csv("./data/Teams_1D2D3DGo_2017.csv", function(data) {
        data.forEach(function(d) {
            var geoLat = parseFloat(d.latitude) ;
            var geoLon = parseFloat(d.longitude) ;			
		    lats.push(geoLat) ;
			lons.push(geoLon) ;
			teamNames.push(d.teamname) ;
			
			console.log(d.teamname + "   lat " + geoLat + "   lon " + geoLon ) ;
    });
	  // console.log(data[0])  ;
	   
	   makeGlobe_and_placemarkers() ;
	   
	  });
  }

  function makeGlobe_and_placemarkers() {
          // Create a WorldWindow for the canvas.
        var wwd = new WorldWind.WorldWindow("canvasOne");

        // Add some image layers to the WorldWindow's globe.
        wwd.addLayer(new WorldWind.BMNGOneImageLayer());
        wwd.addLayer(new WorldWind.BingAerialWithLabelsLayer());

        // Add a compass, a coordinates display and some view controls to the WorldWindow.
        wwd.addLayer(new WorldWind.CompassLayer());
        wwd.addLayer(new WorldWind.CoordinatesDisplayLayer(wwd));
        wwd.addLayer(new WorldWind.ViewControlsLayer(wwd));
		
		var eem = new WorldWind.EarthElevationModel() ;
		var merc = new WorldWind.ProjectionMercator() ;
		var earth = new WorldWind.Globe(eem,merc) ;
		wwd.globe = earth ;
	    wwd.navigator.range = 40000000;              // move out to see the whole map
	    
		var placemarkLayer = new WorldWind.RenderableLayer("Placemarks") ;	

		console.log("lats length " + lats.length.toString()) ;
		
	        var placemark = [] ;
            var placemarkAttributes = new WorldWind.PlacemarkAttributes(null),
            highlightAttributes,
            placemarkLayer = new WorldWind.RenderableLayer("Placemarks") ;	
			var pinLibrary = "./scripts/images/";
			
		for (var i = 0; i < lats.length; i++ ) {
		
           var latitude = lats[i] ;
           var longitude = lons[i];
			
			console.log("current lat " + lats[i].toString() + "    lon " + lons[i].toString()) ;

        // Set up the common placemark attributes.
        placemarkAttributes.imageScale = 0.02;
        placemarkAttributes.imageOffset = new WorldWind.Offset(
            WorldWind.OFFSET_FRACTION, 0.5,
            WorldWind.OFFSET_FRACTION, 0.5);
        placemarkAttributes.imageColor = WorldWind.Color.WHITE;

        // Create the placemark.
      //  placemark = new WorldWind.Placemark(new WorldWind.Position(latitude, longitude, 1e2), false, null);
	    placemark.push(new WorldWind.Placemark(new WorldWind.Position(latitude, longitude, 1e2), false, null));
		
		placemark[i].label = "Team: " + teamNames[i] + "\n" ;
			
        placemark[i].altitudeMode = WorldWind.RELATIVE_TO_GROUND;

        // Create the placemark attributes for the placemark.
        placemarkAttributes = new WorldWind.PlacemarkAttributes(placemarkAttributes);

		placemarkAttributes.imageSource = pinLibrary + images[0] ;
        placemark[i].attributes = placemarkAttributes;

        // Create the highlight attributes for this placemark. Note that the normal attributes are specified as
        // the default highlight attributes so that all properties are identical except the image scale. You could
        // instead vary the color, image, or other property to control the highlight representation.
        highlightAttributes = new WorldWind.PlacemarkAttributes(placemarkAttributes);
        highlightAttributes.imageScale = 0.06;
        placemark[i].highlightAttributes = highlightAttributes;

        // Add the placemark to the layer.
        placemarkLayer.addRenderable(placemark[i]);

	} 
        // Add the placemarks layer to the WorldWindow's layer list.
        wwd.addLayer(placemarkLayer);

        // Create a layer manager for controlling layer visibility.
     //   var layerManger = new WorldWind.LayerManager(wwd);

        // Now set up to handle highlighting.
       var highlightController = new WorldWind.HighlightController(wwd);
  
  }
	
    // Register an event listener to be called when the page is loaded.
    window.addEventListener("load", eventWindowLoaded, false);

    // Define the event listener to initialize Web WorldWind.
    function eventWindowLoaded() {

	      read_CSV_file() ;
}
</script>
</body>
</html>