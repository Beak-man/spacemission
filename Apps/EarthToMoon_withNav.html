<!DOCTYPE html>
<html>
<head>
  <!-- Use correct character set. -->
  <meta charset="utf-8">
  <!-- Tell IE to use the latest, best version. -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <title>Cesium and CSS</title>
    <script src="../Build/Cesium/Cesium.js"></script>
<style>
      @import url(../Build/Cesium/Widgets/widgets.css);
      html, body, #cesiumContainer {
          width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
      }
header {
    background-color:black;
    color:white;
    text-align:center;
    padding:5px;	 
}
nav {
    line-height:30px;
    background-color:#eeeeee;
   /* height:300px; */
    width:200px;
    float:left;
    padding:5px;	  
}
section {
    width:1200px;
    float:left;
    padding:10px;	 	 
}
footer {
    background-color:black;
    color:white;
    clear:both;
    text-align:center;
    padding:5px;	 	 
}
</style>
<script>

function bigPicture() {
      viewer.camera.setView({
      destination : Cesium.Cartesian3.fromDegrees(-117.16, 32.0, 1500000000.0)
     });
	 viewer.trackedEntity = earthCore ;
	 console.log ("big picture") ;
}

function showSpaceCraft() {
    var spaceCraft = czmlDataSource1.entities.getById('lunarProbe') ;	
  //  viewer.zoomTo(spaceCraft, 0,0,-5);
	  viewer.trackedEntity = spaceCraft ;
	  
    console.log ("value of spacCraft variable ", spaceCraft) ;
}
function showTheMoon() {

	var ourMoon = czmlDataSource2.entities.getById('theMoon') ;	
	
	  viewer.zoomTo(ourMoon, 0,0,-2000);
	  viewer.trackedEntity = ourMoon ;
	  
    console.log ("value of ourMoon variable ", ourMoon) ;
}
function showTheEarth() {

	// Set position with a top-down view
      viewer.camera.setView({
      destination : Cesium.Cartesian3.fromDegrees(-117.16, 32.0, 150000000.0)
     });
	 
	  viewer.trackedEntity = earthCore ;
	  
    console.log ("value of ourMoon variable ", ourMoon) ;
}

function initializeButtons() {
	  document.getElementById('showShip').disabled = true;
      document.getElementById('showMoon').disabled = true;
      document.getElementById('showEarth').disabled = true;
      document.getElementById('bigPicture').disabled = true;
      document.getElementById('announcement').innerHTML = "Please wait, models are loading in approximately 30 seconds.";
	  
	  setTimeout(activateButtons,30000) ;
}

function activateButtons() {

   // viewer.entities.collectionChanged.addEventListener(
   //	 	function collectionChangedEventCallback(collection, added, removed, changed) {
	        // Enable the buttons
         document.getElementById('showShip').disabled = false;
         document.getElementById('showMoon').disabled = false;
         document.getElementById('showEarth').disabled = false;
         document.getElementById('bigPicture').disabled = false;
         document.getElementById('announcement').innerHTML = "Models have loaded; select a view point.";
//	}) ;

}

    /**
     * Computes a rotation matrix to transform a point or vector from True Equator Mean Equinox (TEME) axes to the
     * pseudo-fixed axes at a given time.  This method treats the UT1 time standard as equivalent to UTC.
     *
     * @param {Cesium.JulianDate} date The time in either TAI or UTC at which to compute the rotation matrix.
     *
     * @return {Cesium.Matrix3} A rotation matrix that transforms a vector in the TEME axes to the pseudo-fixed axes at the given {@code date}.
     */
    function computeTemeToPseudoFixedMatrix (date) {
        // GMST is actually computed using UT1.  We're using UTC as an approximation of UT1.

        var gmstConstant0 = 6 * 3600 + 41 * 60 + 50.54841;
        var gmstConstant1 = 8640184.812866;
        var gmstConstant2 = 0.093104;
        var gmstConstant3 = -6.2E-6;
        var rateCoef = 1.1772758384668e-19;
        var wgs84WRPrecessing = 7.2921158553E-5;
        var dateInUtc = date.addSeconds(-date.getTaiMinusUtc());

        var t;
        var diffDays = dateInUtc.getJulianDayNumber() - 2451545;
        if (dateInUtc.getSecondsOfDay() >= 43200.0) {
            t = (diffDays + 0.5) / Cesium.TimeConstants.DAYS_PER_JULIAN_CENTURY;
        } else {
            t = (diffDays - 0.5) / Cesium.TimeConstants.DAYS_PER_JULIAN_CENTURY;
        }

        var gmst0 = gmstConstant0 + t * (gmstConstant1 + t * (gmstConstant2 + t * gmstConstant3));
        var angle = (gmst0 * Cesium.Math.TWO_PI / 86400.0) % Cesium.Math.TWO_PI;
        var ratio = wgs84WRPrecessing + rateCoef * (dateInUtc.getJulianDayNumber() - 0.5 - 2451545);

        var secondsSinceMidnight = (dateInUtc.getSecondsOfDay() + Cesium.TimeConstants.SECONDS_PER_DAY / 2.0) % 86400.0;

        var gha = angle + (ratio * secondsSinceMidnight);

        var cosGha = Math.cos(gha);
        var sinGha = Math.sin(gha);
        return new Cesium.Matrix3(cosGha, sinGha, 0.0, -sinGha, cosGha, 0.0, 0.0, 0.0, 1.0);
    }

    var time = new Cesium.JulianDate();

    scene.setAnimation(function() {
        scene.setSunPosition(Cesium.SunPosition.compute(time).position);
        time = time.addSeconds(20.0);

        scene.getCamera().transform = new Cesium.Matrix4(computeTemeToPseudoFixedMatrix(time), Cesium.Cartesian3.ZERO);
    });
</script>
</head>

<body onload="initializeButtons()">

<header>
<h2>Demonstration of a Space Mission Visualization using Cesium</h2>
</header>

<nav>
<h3>Viewpoints</h3><br>
<input type="button" id="bigPicture" value="Big Picture" onclick="bigPicture();" /><br>
<input type="button" id="showShip" value="Spacecraft" onclick="showSpaceCraft();" /><br>
<input type="button" id="showMoon" value="Moon" onclick="showTheMoon();" /><br>
<input type="button" id="showEarth" value="Earth" onclick="showTheEarth();" /><br>
</nav>

<section>
<h2 id="announcement">Earth to Moon trajectory</h2>
  <div id="cesiumContainer"></div>
  <script>
   var viewer = new Cesium.Viewer('cesiumContainer', {
       infoBox : false,
       selectionIndicator : false
	});
		
   var czmlDataSource1 = new Cesium.CzmlDataSource();
       czmlDataSource1.load('LunarProbeTrajectory_withBillboard.czml');
       viewer.dataSources.add(czmlDataSource1); 
	   
   var czmlDataSource2 = new Cesium.CzmlDataSource();
       czmlDataSource2.load('LunarOrbit_withBillboard.czml');
       viewer.dataSources.add(czmlDataSource2);   
		
       viewer.scene.camera.frustum.far = 1e12;            //Move the far wall of the viewing frustum.
	
	// Set position with a top-down view
      viewer.camera.setView({
      destination : Cesium.Cartesian3.fromDegrees(-117.16, 32.0, 1500000000.0)
     });
	
	var earthCore = viewer.entitites.add(
     { id:"core",
       position : Cesium.Cartesian3(0,0,0),
       point: { show : false  }
	 });
	 
	// viewer.extend(Cesium.viewerCesiumInspectorMixin);  //Add Cesium Inspector
</script>
</section>

<footer>
Moon and Spacecraft trajectories were generated with the General Mission Analysis Tool (GMAT).
</footer>

</body>
</html>